<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Typing Master</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: "Inter", sans-serif; }
    .cursor { animation: blink 1s infinite; }
    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0; }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 to-black min-h-screen text-white">

<!-- ===== å·¦ã‚µã‚¤ãƒ‰åºƒå‘Š ===== -->
<div class="hidden lg:block fixed top-1/2 left-4 -translate-y-1/2 w-48 
            bg-white/5 border border-white/10 rounded-xl p-4 text-center shadow-lg">
  <div class="text-xs text-gray-400 mb-2">ã‚¹ãƒãƒ³ã‚µãƒ¼</div>

  <!-- â–¼â–¼ ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã“ã“ â–¼â–¼ -->
  <a href="https://example.com" target="_blank"
     class="block text-indigo-300 hover:underline">
    âŒ¨ï¸ é™éŸ³ãƒ¡ã‚«ãƒ‹ã‚«ãƒ«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰  
    <span class="block text-xs text-gray-400 mt-1">ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãŒé€Ÿããªã‚‹</span>
  </a>
  <!-- â–²â–² ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã“ã“ â–²â–² -->
</div>

<!-- ===== å³ã‚µã‚¤ãƒ‰åºƒå‘Š ===== -->
<div class="hidden lg:block fixed top-1/2 right-4 -translate-y-1/2 w-48 
            bg-white/5 border border-white/10 rounded-xl p-4 text-center shadow-lg">
  <div class="text-xs text-gray-400 mb-2">ã‚¹ãƒãƒ³ã‚µãƒ¼</div>

  <!-- â–¼â–¼ ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã“ã“ â–¼â–¼ -->
  <a href="https://example.com" target="_blank"
     class="block text-emerald-300 hover:underline">
    ğŸ§ é›†ä¸­åŠ›UPãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³  
    <span class="block text-xs text-gray-400 mt-1">ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚°</span>
  </a>
  <!-- â–²â–² ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã“ã“ â–²â–² -->
</div>


<div class="max-w-3xl mx-auto p-8">

  <!-- ===== ãƒ›ãƒ¼ãƒ ç”»é¢ ===== -->
  <div id="home" class="text-center">
    <h1 class="text-5xl font-bold mb-10">Typing Master</h1>
    <div class="space-y-6">
      <button onclick="startGame('long')"
        class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 rounded-xl text-xl transition">
        é•·æ–‡ãƒ¢ãƒ¼ãƒ‰
      </button>
      <button onclick="startGame('word')"
        class="w-full py-4 bg-emerald-600 hover:bg-emerald-500 rounded-xl text-xl transition">
        å˜èªãƒ¢ãƒ¼ãƒ‰
      </button>
    </div>
  </div>

  <!-- ===== ã‚²ãƒ¼ãƒ ç”»é¢ ===== -->
  <div id="game" class="hidden">

    <div class="flex justify-between items-center mb-4">
      <h2 id="modeTitle" class="text-xl font-bold"></h2>
      <button onclick="backToHome()"
        class="text-sm px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">
        æˆ»ã‚‹
      </button>
    </div>

    <div class="bg-white/10 backdrop-blur rounded-xl p-6 shadow-lg">
      <div id="text-ja" class="text-xl leading-relaxed mb-2"></div>
      <div id="text-ro" class="text-lg tracking-widest mb-4 text-indigo-200"></div>

        <input id="input"
          class="w-full p-3 rounded bg-black/40 outline-none focus:ring-2 focus:ring-indigo-400"
          placeholder="ã“ã“ã«å…¥åŠ›..."
          autofocus
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
        />        

      <div class="flex justify-between mt-4 text-sm text-gray-300">
        <div>ãƒŸã‚¹: <span id="miss">0</span></div>
        <div>æ­£ç¢ºç‡: <span id="accuracy">100</span>%</div>
      </div>
    </div>

    <button id="restart"
      class="mt-6 w-full py-3 bg-indigo-600 hover:bg-indigo-500 rounded-xl transition">
      æ¬¡ã®å•é¡Œ
    </button>
  </div>

</div>

<script>
/* ===== å•é¡Œãƒ‡ãƒ¼ã‚¿ ===== */
const longProblems = [
  { ja: "ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ç·´ç¿’ã‚µã‚¤ãƒˆã‚’æœ¬æ ¼çš„ã«ä½œã‚ã†", ro: "taipingu renshuu saito wo honkakuteki ni tsukurou" },
  { ja: "æ¯æ—¥å°‘ã—ãšã¤æˆé•·ã—ã‚ˆã†", ro: "mainichi sukoshizutsu seichou shiyou" },
  { ja: "é›†ä¸­ã—ã¦æœ€å¾Œã¾ã§é ‘å¼µã‚ã†", ro: "shuuchuu shite saigo made ganbarou" },
  { ja: "æ­£ç¢ºã•ã‚’æ„è­˜ã—ã¦æ‰“ã¨ã†", ro: "seikakusa wo ishiki shite utou" }
];

const wordProblems = [
  { ja: "çŒ«", ro: "neko" },
  { ja: "å­¦æ ¡", ro: "gakkou" },
  { ja: "é›»è»Š", ro: "densha" },
  { ja: "å‹é”", ro: "tomodachi" },
  { ja: "éŸ³æ¥½", ro: "ongaku" },
  { ja: "æœ¬", ro: "hon" }
];

let mode = "long";
let text = "";
let text1Display = "";
let text1 = "";

const homeDiv = document.getElementById("home");
const gameDiv = document.getElementById("game");
const modeTitle = document.getElementById("modeTitle");

const textJaDiv = document.getElementById("text-ja");
const textRoDiv = document.getElementById("text-ro");
const input = document.getElementById("input");
const missSpan = document.getElementById("miss");
const accSpan = document.getElementById("accuracy");

let startTime = null;
let miss = 0;

/* ===== ç”»é¢åˆ‡ã‚Šæ›¿ãˆ ===== */
function startGame(selectedMode) {
  mode = selectedMode;
  modeTitle.textContent = (mode === "long") ? "é•·æ–‡ãƒ¢ãƒ¼ãƒ‰" : "å˜èªãƒ¢ãƒ¼ãƒ‰";

  homeDiv.classList.add("hidden");
  gameDiv.classList.remove("hidden");

  restartGame();
}

function backToHome() {
  homeDiv.classList.remove("hidden");
  gameDiv.classList.add("hidden");

  input.value = "";
  miss = 0;
  startTime = null;
}

/* ===== æ–°ã—ã„å•é¡Œã‚’é¸ã¶ ===== */
function pickRandomProblem() {
  const list = (mode === "long") ? longProblems : wordProblems;
  const p = list[Math.floor(Math.random() * list.length)];

  text = p.ja;
  text1Display = p.ro;
  text1 = text1Display.replace(/\s+/g, "");
}

/* ===== æç”» ===== */
function render(value) {
  let jaHtml = "";
  let roHtml = "";
  let displayIndex = 0;

  for (let i = 0; i < text1.length; i++) {
    while (text1Display[displayIndex] === " ") {
      roHtml += `<span class="text-indigo-400"> </span>`;
      displayIndex++;
    }

    const displayChar = text1Display[displayIndex];

    if (i < value.length) {
      const ok = value[i] === text1[i];
      roHtml += `<span class="${ok ? 'text-green-400' : 'text-red-400'}">${displayChar.toUpperCase()}</span>`;
      if (!ok) miss++;
    } else {
      roHtml += `<span class="text-gray-400">${displayChar.toUpperCase()}</span>`;
    }

    displayIndex++;
  }

  while (displayIndex < text1Display.length) {
    const ch = text1Display[displayIndex];
    roHtml += `<span class="text-indigo-400">${ch === " " ? " " : ch.toUpperCase()}</span>`;
    displayIndex++;
  }

  for (let i = 0; i < text.length; i++) {
    jaHtml += `<span class="text-gray-300">${text[i]}</span>`;
  }

  textJaDiv.innerHTML = jaHtml;
  textRoDiv.innerHTML = roHtml;
  missSpan.textContent = miss;

  const acc = Math.max(0, Math.round((1 - miss / Math.max(value.length, 1)) * 100));
  accSpan.textContent = acc;
}

/* ===== å…¥åŠ›å‡¦ç† ===== */
input.addEventListener("input", e => {
  if (!startTime) startTime = Date.now();
  const v = e.target.value.toLowerCase().replace(/\s+/g, "");
  render(v);

  if (v.length >= text1.length) {
    setTimeout(restartGame, 800);
  }
});

/* ===== ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ ===== */
function restartGame() {
  input.value = "";
  miss = 0;
  startTime = null;
  pickRandomProblem();
  render("");
}

document.getElementById("restart").addEventListener("click", restartGame);
</script>

</body>
</html>
